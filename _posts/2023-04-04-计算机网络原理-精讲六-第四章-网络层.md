---
title: 计算机网络原理 精讲六 第四章 网络层
author: mumu
date: 2023-04-04 15:00:00 +0800
categories: [sunlands,计算机网络原理 精讲六 第四章 网络层]
tags: [sunlands,计算机网络原理]
pin: false
---

# 计算机网络原理 精讲六 第四章 网络层 [^1]

## 第一节 网络层服务  

### 1.1. 网络层核心任务

将数据从源主机送达到目的主机。

### 1.2. 网络层的主要功能：

1. 转发； 
2. 路由选择； 
3. 连接建立。  

## 第二节 数据报网络与虚电路网络  

### 2.1. 数据报网络

1. 数据报网络： 按照目的主机地址进行路由选择。
2. 数据报网络： （ 无连接服务）
   源主机每要发送一个分组， 就为该分组加上目的主机地址， 然后将该分组推进网络。 每个路由器使用分组的目的主机地址来转发该分组。  

### 2.2. 虚电路网络  

#### 一、 虚电路（ virtual circuit， VC）： 

源主机到目的主机的一条路径上建立的一条网络层逻辑连接。  

#### 二、 一条虚电路由 3 个要素构成：

1. 从源主机到目的主机之间的一条路径（ 一系列的链路和分组交换机）。
2. 该路径上的每条链路的虚电路标识（ VCID）。
3. 分组交换机的转发表中记录虚电路标识的接续关系。  

### 2.3. 两者对比  

| 项目         | 虚电路交换                                        | 数据报交换                 |
| ------------ | ------------------------------------------------- | -------------------------- |
| 是否建立连接 | 先建立连接                                        | 不建立连接                 |
| 地址         | 每个分组含有一个短的虚电路号                      | 每个分组包含源和目的端地址 |
| 分组顺序     | 按序发送，按序接收                                | 按序发送，不一定按序接收   |
| 路由选择     | 建立VC时需要路由选择，之后所有分 组都沿此路由转发 | 每个分组独立路由选择       |
| 典型网络     | x.25、帧中继、ATM                                 | 因特网                     |

## 第三节 网络互连与网络互连设备  

### 3.1. 异构网络互连

#### 一、 异构网络： 

主要是指两个网络的通信技术和运行协议的不同。

#### 二、 异构网络互连的基本策略： 

> 协议转换和构建虚拟互联网络。

1. 协议转换： 采用一类支持异构网络之间协议转换的网络中间设备， 来实现异构网络之间数据分组的转换与转发。

   > 例如： 交换机或者是多协议路由器。

2. 构建虚拟互联网络： 在异构网络基础上构建一个同构的虚拟互联网络。  

### 3.2. 路由器  

#### 一、 路由器： 

最典型的网络层设备。 具有多个输入端口和多个输出端口的专用计算机， 主要任务就是获取与维护路由信息以及转发分组。

#### 二、 路由器从功能体系结构角度： 

> 输入端口、 交换结构、 输出端口、 路由处理器。

1. <font color='' style='background-color:#FFFF00' size=''>输入端口</font>： 查找， 转发， 到达分组 缓存排队功能。  
2. <font color='' style='background-color:#FFFF00' size=''>交换结构</font>： 完成具体的转发工作， 将输入端口的 IP 数据报交换到指定的输出端口。主要包括： 基于内存交换； 基于总线交换； 基于网络交换。
   + 基于<font color='' style='background-color:#FFFF00' size=''>内存交换</font>： <font color='' style='background-color:#FFFF00' size=''>性能最低</font>， 路由器价格最<font color='' style='background-color:#FFFF00' size=''>便宜</font>
   + 基于<font color='' style='background-color:#FFFF00' size=''>网络交换</font>： <font color='' style='background-color:#FFFF00' size=''>性能最高</font>， 路由器价格<font color='' style='background-color:#FFFF00' size=''>昂贵</font>
3. <font color='' style='background-color:#FFFF00' size=''>输出端口</font>： 缓存排队， 从队列中取出分组进行数据链路层数据帧的封装， 发送。
   + 先到先服务(FCFS)调度策略； 
   + 按优先级调度
   + 按 IP 数据报的服务类型（ Tos） 调度。
4. <font color='' style='background-color:#FFFF00' size=''>路由处理器</font>： 执行命令； 路由协议运行； 路由计算以及路由表的更新和维护。  

## 第四节 网络层拥塞控制  

### 4.1. 网络拥塞  

#### 一、 网络层拥塞： 

一种持续过载的网络状态。 用户对网络资源（ 包括链路带宽、 存储空间和处理器处理能力等） 的总需求超过了网络固有的容量。

#### 二、 网络负载在<font color='' style='background-color:#FFFF00' size=''>膝点</font>附近时， 吞吐量和分组平均延迟达到理想的平衡， 网络的使用效率最高。

#### 三、 发生拥塞的原因：

1. 缓冲区容量有限
2. 传输线路的带宽有限
3. 网络结点的处理能力有限
4. 网络中某些部分发生了故障  

### 4.2. 网络层拥塞控制措施  

#### 一、 <font color='red' style='background-color:' size=''>流量感知路由</font>：

网络经常被抽象为一张带权无向图， 权值能够根据网络负载动态调整，则可以将网络流量引导到不同的链路上， 均衡网络负载， 从而延缓或避免拥塞的发生。

#### 二、<font color='red' style='background-color:' size=''> 准入控制</font>： 

是对新建虚电路审核， 如果新建立的虚电路会导致网络变得拥塞， 那么网络拒绝建立该新虚电路。

#### 三、 <font color='red' style='background-color:' size=''>流量调节</font>： 

在网络拥塞时， 可以通过调整发送方发送数据的速率来消除拥塞。

+ 抑制分组： 感知到拥塞的路由器选择一个被拥塞的数据报， 给该数据报的源主机返回一个抑制分组。
+ 背压： 抑制分组在从拥塞结点到源结点的路径上的每一跳， 都发挥抑制作用。

#### 四、 <font color='red' style='background-color:' size=''>负载脱落</font>：

 通过有选择地主动丢弃一些数据报， 来减轻网络负载， 从而缓解或消除拥塞。  

## 第五节 Internet 网络层  

### 5.1. IPv4 协议

#### 一、 Internet 网络层主要协议：  

1. 网际协议（ Internet Protocol,IP）
2. 路由协议
3. 互联网控制报文协议（ Internet Control Message Protocol,ICMP）

#### 二、 IP 协议版本及作用

1. 目前两个版本： IPv4 和 IPv6

2. IPv4 协议： Internet 网络层最核心的协议。

   定义了如何封装上层协议（ 如 UDP、 TCP 等） 的报文段；
   定义了 Internet 网络层寻址（ IP 地址） 以及如何转发 IP 数据报等内容；  

#### 三、 IP 数据报格式  

![image-20230404151921547](https://raw.githubusercontent.com/sn-mumu/cloud-storage/main/PicGo/202304041519616.png)

1. 版本号:4 位， IPv4、 IPv6。

2. 首部长度:4 位。

3. 区分服务:在旧标准种称为服务类型(Type Of Service,TOS)字段用来指示期望获得哪种类型的服务。

4. 数据报长度:16 位， 指出 IP 数据报的总字节数。

5. 生存时间:8 位， 表示 IP 数据报 在网络中可以通过的路由器数(或跳步数)。

6. 上层协议:8 位， 指示该 IP 数据报封装的是哪个上层协议。 TCP:6； UDP:17  

7.  首部校验和:占 16 位， 利用校验和实现对 IP 数据报首部的差错检测

8. 源 IP 地址字段占 32 位， 发出 IP 数据报的源主机的 IP 地址。

9. 目的 IP 地址字段占 32 位， IP 数据报的需要送达的主机的 IP 地址。

10. 选项:长度可变。

11. 数据字段， 数据字段存放 IP 数据报所封装的传输层报文段。

12. 标识:字段占 16 位， 标识一个 IP 数据报

13. 标志:标志位字段占 3 位。

    + <font color='red' style='background-color:' size=''>DF 禁止分片标志</font>： 

      > DF=0， 允许分片； 
      >
      > DF=1， 禁止分片；

    + <font color='red' style='background-color:' size=''>MF 更多分片标志</font>： 

      > MF=0， 未被分片或分片的最后一片。
      > MF=1， 一定是分片， 且不是最后一个。

14. <font color='red' style='background-color:' size=''>片偏移量:以 8B（ 8 字节） 为单位</font>。 表示一个 IP 数据报分片与原 IP 数据报数据的相对偏移量。

    > 当该字段值为 0 时， 且 MF=1， 则表示这是一个 IP 分片， 且是第一个分片。  

#### 四、 IP 数据报分片  

1. 最大传输单元(Maximum Transmission Unit,MTU)

2. IP 数据报分片的相关计算方法：

   > 原数据 IP 报总长度为 L 字节， 待转发链路的 MTU 为 M 字节。
   >
   > + 尽可能少分片。
   > + 一个最大分片可封装的数据字节数是 8 的倍数。
   >
   > 每个分片的标识字段复制原 IP 数据报的标识字段。 MF 标志位， 除了最后一个分片位 0外， 其余分片全为 1。  

3. ***分片例题：***  

   > 通过 PingPlotter 工具发送一个总长度为 3400 字节的 IP 数据报， 通过 MTU=1500 字节的链路转发。  ![image-20230404152358394](https://raw.githubusercontent.com/sn-mumu/cloud-storage/main/PicGo/202304041523457.png)



















































[^1]: [尚德机构](https://xt.shuhanfenglin.com/) 